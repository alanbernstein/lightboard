<html>
    <head>
        <title>color sliders</title>
        <script>

         // https://andi-siess.de/rgb-to-color-temperature/
         // HernÃ¡ndez 1999
         // http://www.vendian.org/mncharity/dir3/blackbody/UnstableURLs/bbr_color.html

         kelvinTable = {
             0: '#000000',
             200: '#000000',
             400: '#000000',
             600: '#000000',
             800: '#000000',
             1000: '#ff3800',
             1200: '#ff5300',
             1400: '#ff6500',
             1600: '#ff7300',
             1800: '#ff7e00',
             2000: '#ff8912',
             2200: '#ff932c',
             2400: '#ff9d3f',
             2600: '#ffa54f',
             2800: '#ffad5e',
             3000: '#ffb46b',
             3200: '#ffbb78',
             3400: '#ffc184',
             3600: '#ffc78f',
             3800: '#ffcc99',
             4000: '#ffd1a3',
             4200: '#ffd5ad',
             4400: '#ffd9b6',
             4600: '#ffddbe',
             4800: '#ffe1c6',
             5000: '#ffe4ce',
             5200: '#ffe8d5',
             5400: '#ffebdc',
             5600: '#ffeee3',
             5800: '#fff0e9',
             6000: '#fff3ef',
             6200: '#fff5f5',
             6400: '#fff8fb',
             6600: '#fef9ff',
             6800: '#f9f6ff',
             7000: '#f5f3ff',
             7200: '#f0f1ff',
             7400: '#edefff',
             7600: '#e9edff',
             7800: '#e6ebff',
             8000: '#e3e9ff',
             8200: '#e0e7ff',
             8400: '#dde6ff',
             8600: '#dae4ff',
             8800: '#d8e3ff',
             9000: '#d6e1ff',
             9200: '#d3e0ff',
             9400: '#d1dfff',
             9600: '#cfddff',
             9800: '#cedcff',
             10000: '#ccdbff',
             10200: '#cadaff',
             10400: '#c9d9ff',
             10600: '#c7d8ff',
             10800: '#c6d8ff',
             11000: '#c4d7ff',
             11200: '#c3d6ff',
             11400: '#c2d5ff',
             11600: '#c1d4ff',
             11800: '#c0d4ff',
             12000: '#bfd3ff',
             12200: '#bed2ff',
             12400: '#bdd2ff',
             12600: '#bcd1ff',
             12800: '#bbd1ff',
             13000: '#bad0ff',
             13200: '#b9d0ff',
             13400: '#b8cfff',
             13600: '#b7cfff',
             13800: '#b7ceff',
             14000: '#b6ceff',
             14200: '#b5cdff',
             14400: '#b5cdff',
             14600: '#b4ccff',
             14800: '#b3ccff',
             15000: '#b3ccff',
             15200: '#b2cbff',
             15400: '#b2cbff',
             15600: '#b1caff',
             15800: '#b1caff',
             16000: '#b0caff',
             16200: '#afc9ff',
             16400: '#afc9ff',
             16600: '#afc9ff',
             16800: '#aec9ff',
             17000: '#aec8ff',
             17200: '#adc8ff',
             17400: '#adc8ff',
             17600: '#acc7ff',
             17800: '#acc7ff',
             18000: '#acc7ff',
             18200: '#abc7ff',
             18400: '#abc6ff',
             18600: '#aac6ff',
             18800: '#aac6ff',
             19000: '#aac6ff',
             19200: '#a9c6ff',
             19400: '#a9c5ff',
             19600: '#a9c5ff',
             19800: '#a9c5ff',
             20000: '#a8c5ff',
             20200: '#a8c5ff',
             20400: '#a8c4ff',
             20600: '#a7c4ff',
             20800: '#a7c4ff',
             21000: '#a7c4ff',
             21200: '#a7c4ff',
             21400: '#a6c3ff',
             21600: '#a6c3ff',
             21800: '#a6c3ff',
             22000: '#a6c3ff',
             22200: '#a5c3ff',
             22400: '#a5c3ff',
             22600: '#a5c3ff',
             22800: '#a5c2ff',
             23000: '#a4c2ff',
             23200: '#a4c2ff',
             23400: '#a4c2ff',
             23600: '#a4c2ff',
             23800: '#a4c2ff',
             24000: '#a3c2ff',
             24200: '#a3c1ff',
             24400: '#a3c1ff',
             24600: '#a3c1ff',
             24800: '#a3c1ff',
             25000: '#a3c1ff',
             25200: '#a2c1ff',
             25400: '#a2c1ff',
             25600: '#a2c1ff',
             25800: '#a2c1ff',
             26000: '#a2c0ff',
             26200: '#a2c0ff',
             26400: '#a1c0ff',
             26600: '#a1c0ff',
             26800: '#a1c0ff',
             27000: '#a1c0ff',
             27200: '#a1c0ff',
             27400: '#a1c0ff',
             27600: '#a1c0ff',
             27800: '#a0c0ff',
             28000: '#a0bfff',
             28200: '#a0bfff',
             28400: '#a0bfff',
             28600: '#a0bfff',
             28800: '#a0bfff',
             29000: '#a0bfff',
             29200: '#a0bfff',
             29400: '#9fbfff',
             29600: '#9fbfff',
             29800: '#9fbfff',
        };
        
        
        // https://www.johndcook.com/wavelength_to_RGB.html
        // TODO: physics-based version
        // - https://gist.github.com/friendly/67a7df339aa999e2bcfcfec88311abfc
        // - https://www.fourmilab.ch/documents/specrend/
        // - https://aty.sdsu.edu/explain/optics/rendering.html
        // - https://stackoverflow.com/questions/3407942/rgb-values-of-visible-spectrum/22681410#22681410
        function wavelengthToRGB(w) {
            if (w >= 380 && w < 440) {
                red   = -(w - 440) / (440 - 380);
                green = 0.0;
                blue  = 1.0;
            } else if (w >= 440 && w < 490) {
                red   = 0.0;
                green = (w - 440) / (490 - 440);
                blue  = 1.0;
            } else if (w >= 490 && w < 510) {
                red   = 0.0;
                green = 1.0;
                blue  = -(w - 510) / (510 - 490);
            } else if (w >= 510 && w < 580) {
                red   = (w - 510) / (580 - 510);
                green = 1.0;
                blue  = 0.0;
            } else if (w >= 580 && w < 645) {
                red   = 1.0;
                green = -(w - 645) / (645 - 580);
                blue  = 0.0;
            } else if (w >= 645 && w < 781) {
                red   = 1.0;
                green = 0.0;
                blue  = 0.0;
            } else {
                red   = 0.0;
                green = 0.0;
                blue  = 0.0;
            }
        
            // Let the intensity fall off near the vision limits
            if (w >= 380 && w < 420)
                factor = 0.3 + 0.7*(w - 380) / (420 - 380);
            else if (w >= 420 && w < 701)
                factor = 1.0;
            else if (w >= 701 && w < 781)
                factor = 0.3 + 0.7*(780 - w) / (780 - 700);
            else
                factor = 0.0;
        
            var gamma = 0.80;
            var R = (red   > 0 ? 255*Math.pow(red   * factor, gamma) : 0);
            var G = (green > 0 ? 255*Math.pow(green * factor, gamma) : 0);
            var B = (blue  > 0 ? 255*Math.pow(blue  * factor, gamma) : 0); 
        
            var hex = "#" + decimalToHex(R) + decimalToHex(G) + decimalToHex(B);
            return hex
        }
        
        function decimalToHex(d) {
            d = Math.round(d);
            var hex = d.toString(16);
            while (hex.length < 2) {
                hex = "0" + hex;
            }
        
            return hex;
        }

        function updateKelvinSlider(kelvins) {
            hexColor = kelvinTable[kelvins];
            document.body.style.background = hexColor;
	        updateRGBLabels(hexColor);
            var el = document.getElementById("kelvin-label");
	        el.innerHTML = kelvins;
        }

        function updateWavelengthSlider(nm) {
            hexColor = wavelengthToRGB(nm);
            document.body.style.background = hexColor;
	        updateRGBLabels(hexColor);
            var el = document.getElementById("wavelength-label");
	        el.innerHTML = nm + "nm";
        }

        function updateGraySlider(gray) {
            hexColor = '#' + decimalToHex(gray * (1+256+65536))
            console.log(gray, hexColor)
            document.body.style.background = hexColor;
	        updateRGBLabels(hexColor);
            var el = document.getElementById("gray-label");
	        el.innerHTML = gray;
        }
         
        function updateButton(hexColor) {
            document.body.style.background = hexColor;
            updateRGBLabels(hexColor);
        }
         
        function updateRGBLabels(hexColor) {
            redval = parseInt(hexColor.substring(1, 3), 16);
            greenval = parseInt(hexColor.substring(3, 5), 16);
            blueval = parseInt(hexColor.substring(5, 7), 16);
            var red = document.getElementById("red-label");
            red.innerHTML = redval;
            var green = document.getElementById("green-label");
            green.innerHTML = greenval
            var blue = document.getElementById("blue-label");
            blue.innerHTML = blueval
        }

        </script>
        
        <style>
        body {
            font-family: arial,sans-serif;
        }
        
        .red {background-color: #ff0000;}
        .green {background-color: #00ff00;}
        .blue {background-color: #0000ff;}
        .cyan {background-color: #00ffff;}
        .magenta {background-color: #ff00ff;}
        .yellow {background-color: #ffff00;}
        .white {background-color: #ffffff;}
        .black {background-color: #000000;}
        
        .slider-label {
            display: inline-block;
            width: 150px;
        }
        </style>
    </head>
    <body>

        <p>RGB: <span id="red-label"></span>, <span id="green-label"></span>, <span id="blue-label"></span></p>
        
        <!-- TODO make the slider show the colors -->
        <p>
            <span class="slider-label">Kelvins: <span id="kelvin-label"></span></span> 
            <input type="range" min="0" max="29800" step="200" value="5000" class="slider" id="kelvin-slider" onchange="updateKelvinSlider(this.value)">
        </p>

        <!-- wavelength -->
        <p>
            <span class="slider-label">Wavelength: <span id="wavelength-label"></span></span> 
            <input type="range" min="380" max="780" step="1" value="400" class="slider" id="wavelength-slider" onchange="updateWavelengthSlider(this.value)">
        </p>

        <!-- atmosphere -->
        <!--
        TODO sunlight at time-of-day
        <p>
            <span class="slider-label">Sky time: <span id="wavelength-label"></span></span> 
            <input type="range" min="0" max="100" step="1" value="0" class="slider" id="sky-slider" onchange="updateSkySlider(this.value)">
        </p>
        -->
        
        <!-- gray -->
        <p>
            <span class="slider-label">Gray: <span id="gray-label"></span></span> 
            <input type="range" min="0" max="255" step="1" value="0" class="slider" id="gray-slider" onchange="updateGraySlider(this.value)">
        </p>

        <!-- primaries -->
        <p>Primary: 
            <button class="red" onclick="updateButton('#ff0000')">&nbsp;</button> 
            <button class="green" onclick="updateButton('#00ff00')">&nbsp;</button> 
            <button class="blue" onclick="updateButton('#0000ff')">&nbsp;</button>
            <button class="cyan" onclick="updateButton('#00ffff')">&nbsp;</button> 
            <button class="magenta" onclick="updateButton('#ff00ff')">&nbsp;</button> 
            <button class="yellow" onclick="updateButton('#ffff00')">&nbsp;</button>
            <button class="white" onclick="updateButton('#ffffff')">&nbsp;</button> 
            <button class="black" onclick="updateButton('#000000')">&nbsp;</button> 
        </p>

        <script>
        var kelvinSlider = document.getElementById("kelvin-slider");
        kelvinSlider.focus()
        updateKelvinSlider(kelvinSlider.value);
        </script>
    </body>
</html>
