<html>
    <head>
        <title>color sliders</title>
        <script>

         // https://andi-siess.de/rgb-to-color-temperature/
         // HernÃ¡ndez 1999
         // http://www.vendian.org/mncharity/dir3/blackbody/UnstableURLs/bbr_color.html

         // TODO: Implement physics-based atmospheric scattering for sunset colors
         // Current colors are aesthetic approximations. For physics-based:
         // - Rayleigh scattering (molecules): blue light scattering, proportional to 1/λ^4
         // - Mie scattering (particles): affects all wavelengths more equally
         // - Sun angle determines path length through atmosphere
         // References:
         // - https://www.scratchapixel.com/lessons/procedural-generation-virtual-worlds/simulating-sky
         // - Nishita et al. "Display of the Earth Taking into Account Atmospheric Scattering"
         // - Eric Bruneton's atmospheric scattering model
         sunsetColors = [
             { pos: 0, r: 0, g: 31, b: 63 },      // Deep night blue
             { pos: 20, r: 8, g: 51, b: 88 },     // Pre-dawn blue
             { pos: 35, r: 26, g: 76, b: 122 },   // Dawn blue
             { pos: 45, r: 255, g: 107, b: 53 },  // Sunset orange
             { pos: 50, r: 255, g: 140, b: 66 },  // Peak sunset
             { pos: 55, r: 255, g: 215, b: 0 },   // Golden hour
             { pos: 70, r: 255, g: 228, b: 181 }, // Late golden hour
             { pos: 85, r: 135, g: 206, b: 235 }, // Sky blue
             { pos: 100, r: 173, g: 216, b: 230 } // Light day blue
         ];

         kelvinTable = {
             0: '#000000',
             200: '#000000',
             400: '#000000',
             600: '#000000',
             800: '#000000',
             1000: '#ff3800',
             1200: '#ff5300',
             1400: '#ff6500',
             1600: '#ff7300',
             1800: '#ff7e00',
             2000: '#ff8912',
             2200: '#ff932c',
             2400: '#ff9d3f',
             2600: '#ffa54f',
             2800: '#ffad5e',
             3000: '#ffb46b',
             3200: '#ffbb78',
             3400: '#ffc184',
             3600: '#ffc78f',
             3800: '#ffcc99',
             4000: '#ffd1a3',
             4200: '#ffd5ad',
             4400: '#ffd9b6',
             4600: '#ffddbe',
             4800: '#ffe1c6',
             5000: '#ffe4ce',
             5200: '#ffe8d5',
             5400: '#ffebdc',
             5600: '#ffeee3',
             5800: '#fff0e9',
             6000: '#fff3ef',
             6200: '#fff5f5',
             6400: '#fff8fb',
             6600: '#fef9ff',
             6800: '#f9f6ff',
             7000: '#f5f3ff',
             7200: '#f0f1ff',
             7400: '#edefff',
             7600: '#e9edff',
             7800: '#e6ebff',
             8000: '#e3e9ff',
             8200: '#e0e7ff',
             8400: '#dde6ff',
             8600: '#dae4ff',
             8800: '#d8e3ff',
             9000: '#d6e1ff',
             9200: '#d3e0ff',
             9400: '#d1dfff',
             9600: '#cfddff',
             9800: '#cedcff',
             10000: '#ccdbff',
             10200: '#cadaff',
             10400: '#c9d9ff',
             10600: '#c7d8ff',
             10800: '#c6d8ff',
             11000: '#c4d7ff',
             11200: '#c3d6ff',
             11400: '#c2d5ff',
             11600: '#c1d4ff',
             11800: '#c0d4ff',
             12000: '#bfd3ff',
             12200: '#bed2ff',
             12400: '#bdd2ff',
             12600: '#bcd1ff',
             12800: '#bbd1ff',
             13000: '#bad0ff',
             13200: '#b9d0ff',
             13400: '#b8cfff',
             13600: '#b7cfff',
             13800: '#b7ceff',
             14000: '#b6ceff',
             14200: '#b5cdff',
             14400: '#b5cdff',
             14600: '#b4ccff',
             14800: '#b3ccff',
             15000: '#b3ccff',
             15200: '#b2cbff',
             15400: '#b2cbff',
             15600: '#b1caff',
             15800: '#b1caff',
             16000: '#b0caff',
             16200: '#afc9ff',
             16400: '#afc9ff',
             16600: '#afc9ff',
             16800: '#aec9ff',
             17000: '#aec8ff',
             17200: '#adc8ff',
             17400: '#adc8ff',
             17600: '#acc7ff',
             17800: '#acc7ff',
             18000: '#acc7ff',
             18200: '#abc7ff',
             18400: '#abc6ff',
             18600: '#aac6ff',
             18800: '#aac6ff',
             19000: '#aac6ff',
             19200: '#a9c6ff',
             19400: '#a9c5ff',
             19600: '#a9c5ff',
             19800: '#a9c5ff',
             20000: '#a8c5ff',
             20200: '#a8c5ff',
             20400: '#a8c4ff',
             20600: '#a7c4ff',
             20800: '#a7c4ff',
             21000: '#a7c4ff',
             21200: '#a7c4ff',
             21400: '#a6c3ff',
             21600: '#a6c3ff',
             21800: '#a6c3ff',
             22000: '#a6c3ff',
             22200: '#a5c3ff',
             22400: '#a5c3ff',
             22600: '#a5c3ff',
             22800: '#a5c2ff',
             23000: '#a4c2ff',
             23200: '#a4c2ff',
             23400: '#a4c2ff',
             23600: '#a4c2ff',
             23800: '#a4c2ff',
             24000: '#a3c2ff',
             24200: '#a3c1ff',
             24400: '#a3c1ff',
             24600: '#a3c1ff',
             24800: '#a3c1ff',
             25000: '#a3c1ff',
             25200: '#a2c1ff',
             25400: '#a2c1ff',
             25600: '#a2c1ff',
             25800: '#a2c1ff',
             26000: '#a2c0ff',
             26200: '#a2c0ff',
             26400: '#a1c0ff',
             26600: '#a1c0ff',
             26800: '#a1c0ff',
             27000: '#a1c0ff',
             27200: '#a1c0ff',
             27400: '#a1c0ff',
             27600: '#a1c0ff',
             27800: '#a0c0ff',
             28000: '#a0bfff',
             28200: '#a0bfff',
             28400: '#a0bfff',
             28600: '#a0bfff',
             28800: '#a0bfff',
             29000: '#a0bfff',
             29200: '#a0bfff',
             29400: '#9fbfff',
             29600: '#9fbfff',
             29800: '#9fbfff',
        };
        
        
        // https://www.johndcook.com/wavelength_to_RGB.html
        // TODO: physics-based version
        // - https://gist.github.com/friendly/67a7df339aa999e2bcfcfec88311abfc
        // - https://www.fourmilab.ch/documents/specrend/
        // - https://aty.sdsu.edu/explain/optics/rendering.html
        // - https://stackoverflow.com/questions/3407942/rgb-values-of-visible-spectrum/22681410#22681410
        function wavelengthToRGB(w) {
            if (w >= 380 && w < 440) {
                red   = -(w - 440) / (440 - 380);
                green = 0.0;
                blue  = 1.0;
            } else if (w >= 440 && w < 490) {
                red   = 0.0;
                green = (w - 440) / (490 - 440);
                blue  = 1.0;
            } else if (w >= 490 && w < 510) {
                red   = 0.0;
                green = 1.0;
                blue  = -(w - 510) / (510 - 490);
            } else if (w >= 510 && w < 580) {
                red   = (w - 510) / (580 - 510);
                green = 1.0;
                blue  = 0.0;
            } else if (w >= 580 && w < 645) {
                red   = 1.0;
                green = -(w - 645) / (645 - 580);
                blue  = 0.0;
            } else if (w >= 645 && w < 781) {
                red   = 1.0;
                green = 0.0;
                blue  = 0.0;
            } else {
                red   = 0.0;
                green = 0.0;
                blue  = 0.0;
            }
        
            // Let the intensity fall off near the vision limits
            if (w >= 380 && w < 420)
                factor = 0.3 + 0.7*(w - 380) / (420 - 380);
            else if (w >= 420 && w < 701)
                factor = 1.0;
            else if (w >= 701 && w < 781)
                factor = 0.3 + 0.7*(780 - w) / (780 - 700);
            else
                factor = 0.0;
        
            var gamma = 0.80;
            var R = (red   > 0 ? 255*Math.pow(red   * factor, gamma) : 0);
            var G = (green > 0 ? 255*Math.pow(green * factor, gamma) : 0);
            var B = (blue  > 0 ? 255*Math.pow(blue  * factor, gamma) : 0); 
        
            var hex = "#" + decimalToHex(R) + decimalToHex(G) + decimalToHex(B);
            return hex
        }
        
        function decimalToHex(d) {
            d = Math.round(d);
            var hex = d.toString(16);
            while (hex.length < 2) {
                hex = "0" + hex;
            }

            return hex;
        }

        function setActiveControl(controlId) {
            // Remove active class from all slider containers
            var containers = document.querySelectorAll('.slider-container');
            containers.forEach(function(container) {
                container.classList.remove('active');
            });

            // Remove active class from all buttons
            var buttons = document.querySelectorAll('.color-button');
            buttons.forEach(function(button) {
                button.classList.remove('active');
            });

            // Add active class to the specified control
            if (controlId) {
                var element = document.getElementById(controlId);
                if (element) {
                    if (element.classList.contains('slider')) {
                        // For sliders, activate the parent container
                        element.closest('.slider-container').classList.add('active');
                    } else if (element.classList.contains('color-button')) {
                        // For buttons, activate the button itself
                        element.classList.add('active');
                    }
                }
            }
        }

        function updateKelvinSlider(kelvins) {
            setActiveControl('kelvin-slider');
            hexColor = kelvinTable[kelvins];
            document.body.style.background = hexColor;
	        updateRGBLabels(hexColor);
            var el = document.getElementById("kelvin-label");
	        el.innerHTML = kelvins;
        }

        function updateWavelengthSlider(nm) {
            setActiveControl('wavelength-slider');
            hexColor = wavelengthToRGB(nm);
            document.body.style.background = hexColor;
	        updateRGBLabels(hexColor);
            var el = document.getElementById("wavelength-label");
	        el.innerHTML = nm + "nm";
        }

        function updateGraySlider(gray) {
            setActiveControl('gray-slider');
            hexColor = '#' + decimalToHex(gray * (1+256+65536))
            console.log(gray, hexColor)
            document.body.style.background = hexColor;
	        updateRGBLabels(hexColor);
            var el = document.getElementById("gray-label");
	        el.innerHTML = gray;
        }

        function updateSunsetSlider(value) {
            setActiveControl('sunset-slider');

            // Find the two colors to interpolate between
            var lower = sunsetColors[0];
            var upper = sunsetColors[sunsetColors.length - 1];

            for (var i = 0; i < sunsetColors.length - 1; i++) {
                if (value >= sunsetColors[i].pos && value <= sunsetColors[i + 1].pos) {
                    lower = sunsetColors[i];
                    upper = sunsetColors[i + 1];
                    break;
                }
            }

            // Interpolate
            var range = upper.pos - lower.pos;
            var rangePct = range === 0 ? 0 : (value - lower.pos) / range;
            var r = Math.round(lower.r + (upper.r - lower.r) * rangePct);
            var g = Math.round(lower.g + (upper.g - lower.g) * rangePct);
            var b = Math.round(lower.b + (upper.b - lower.b) * rangePct);

            hexColor = '#' + decimalToHex(r) + decimalToHex(g) + decimalToHex(b);
            document.body.style.background = hexColor;
            updateRGBLabels(hexColor);
            var el = document.getElementById("sunset-label");

            // Label based on position
            var label = "";
            if (value < 25) label = "Night";
            else if (value < 40) label = "Pre-dawn";
            else if (value < 48) label = "Dawn";
            else if (value < 53) label = "Sunset";
            else if (value < 65) label = "Golden Hour";
            else if (value < 80) label = "Late Golden";
            else label = "Day";

            el.innerHTML = label;
        }

        function updateButton(hexColor, buttonElement) {
            if (buttonElement && buttonElement.id) {
                setActiveControl(buttonElement.id);
            }
            document.body.style.background = hexColor;
            updateRGBLabels(hexColor);
        }
         
        function updateRGBLabels(hexColor) {
            redval = parseInt(hexColor.substring(1, 3), 16);
            greenval = parseInt(hexColor.substring(3, 5), 16);
            blueval = parseInt(hexColor.substring(5, 7), 16);
            var red = document.getElementById("red-label");
            red.innerHTML = redval;
            var green = document.getElementById("green-label");
            green.innerHTML = greenval
            var blue = document.getElementById("blue-label");
            blue.innerHTML = blueval
        }

        </script>
        
        <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            padding: 1rem;
            transition: background 0.3s ease;
        }

        .controls {
            max-width: 500px;
        }

        .rgb-display {
            font-size: 0.875rem;
            margin-bottom: 1rem;
            padding: 0.35rem 0.75rem;
            font-weight: 500;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            border-radius: 20px;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .slider-container {
            margin-bottom: 1rem;
            padding: 0.5rem;
            padding-left: 0.75rem;
            border-radius: 8px;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .slider-container.active {
            border-left-color: rgba(255, 255, 255, 0.9);
            background: rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(8px);
        }

        .slider-label {
            display: block;
            margin-bottom: 0.35rem;
            font-weight: 500;
            color: white;
            font-size: 0.8rem;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        }

        .slider-label-value {
            float: right;
            font-weight: 400;
            background: rgba(0, 0, 0, 0.4);
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
            font-size: 0.75rem;
        }

        /* Custom slider styling */
        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            outline: none;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4),
                        0 1px 3px rgba(0, 0, 0, 0.3);
        }

        /* Slider thumb */
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            border: 2px solid rgba(0, 0, 0, 0.5);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5),
                        0 1px 3px rgba(0, 0, 0, 0.4);
            transition: transform 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.6);
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            border: 2px solid rgba(0, 0, 0, 0.5);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5),
                        0 1px 3px rgba(0, 0, 0, 0.4);
            transition: transform 0.2s ease;
        }

        .slider::-moz-range-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.6);
        }

        /* Individual slider gradients - will be set dynamically via JavaScript */
        #gray-slider {
            background: linear-gradient(to right, #000000, #808080, #ffffff);
        }

        /* Primary buttons */
        .button-container {
            margin-top: 1rem;
            padding-top: 0.75rem;
        }

        .button-container label {
            display: inline-block;
            margin-bottom: 0.5rem;
            padding: 0.25rem 0.6rem;
            font-weight: 500;
            color: white;
            font-size: 0.75rem;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            border-radius: 12px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
        }

        .color-buttons {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .color-button {
            width: 36px;
            height: 36px;
            border: 2px solid rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            position: relative;
        }

        .color-button.active::after {
            content: '';
            position: absolute;
            inset: -4px;
            border: 2px solid rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            pointer-events: none;
        }

        .color-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
        }

        .color-button:active {
            transform: translateY(0) scale(1);
        }

        .red {background-color: #ff0000;}
        .green {background-color: #00ff00;}
        .blue {background-color: #0000ff;}
        .cyan {background-color: #00ffff;}
        .magenta {background-color: #ff00ff;}
        .yellow {background-color: #ffff00;}
        .white {background-color: #ffffff;}
        .black {background-color: #000000;}
        </style>
    </head>
    <body>
        <div class="controls">
            <div class="rgb-display">RGB: <span id="red-label"></span>, <span id="green-label"></span>, <span id="blue-label"></span></div>

            <div class="slider-container">
                <div class="slider-label">
                    Color Temperature
                    <span class="slider-label-value"><span id="kelvin-label"></span>K</span>
                </div>
                <input type="range" min="0" max="29800" step="200" value="5000" class="slider" id="kelvin-slider" onchange="updateKelvinSlider(this.value)">
            </div>

            <div class="slider-container">
                <div class="slider-label">
                    Wavelength
                    <span class="slider-label-value"><span id="wavelength-label"></span></span>
                </div>
                <input type="range" min="380" max="780" step="1" value="400" class="slider" id="wavelength-slider" onchange="updateWavelengthSlider(this.value)">
            </div>

            <div class="slider-container">
                <div class="slider-label">
                    Sunset Gradient
                    <span class="slider-label-value"><span id="sunset-label"></span></span>
                </div>
                <input type="range" min="0" max="100" step="1" value="50" class="slider" id="sunset-slider" onchange="updateSunsetSlider(this.value)">
            </div>

            <div class="slider-container">
                <div class="slider-label">
                    Grayscale
                    <span class="slider-label-value"><span id="gray-label"></span></span>
                </div>
                <input type="range" min="0" max="255" step="1" value="0" class="slider" id="gray-slider" onchange="updateGraySlider(this.value)">
            </div>

            <div class="button-container">
                <label>Primary Colors</label>
                <div class="color-buttons">
                    <button class="color-button red" id="button-red" onclick="updateButton('#ff0000', this)"></button>
                    <button class="color-button green" id="button-green" onclick="updateButton('#00ff00', this)"></button>
                    <button class="color-button blue" id="button-blue" onclick="updateButton('#0000ff', this)"></button>
                    <button class="color-button cyan" id="button-cyan" onclick="updateButton('#00ffff', this)"></button>
                    <button class="color-button magenta" id="button-magenta" onclick="updateButton('#ff00ff', this)"></button>
                    <button class="color-button yellow" id="button-yellow" onclick="updateButton('#ffff00', this)"></button>
                    <button class="color-button white" id="button-white" onclick="updateButton('#ffffff', this)"></button>
                    <button class="color-button black" id="button-black" onclick="updateButton('#000000', this)"></button>
                </div>
            </div>
        </div>

        <script>
        // Generate dynamic gradients for sliders
        function initializeSliderGradients() {
            // Kelvin slider gradient
            var kelvinStops = [];
            var kelvinKeys = Object.keys(kelvinTable).map(Number).sort(function(a, b) { return a - b; });
            var kelvinMin = kelvinKeys[0];
            var kelvinMax = kelvinKeys[kelvinKeys.length - 1];

            // Sample every 10th value for performance
            for (var i = 0; i < kelvinKeys.length; i += 10) {
                var kelvin = kelvinKeys[i];
                var percentage = ((kelvin - kelvinMin) / (kelvinMax - kelvinMin)) * 100;
                kelvinStops.push(kelvinTable[kelvin] + ' ' + percentage + '%');
            }
            // Add the last value
            var lastKelvin = kelvinKeys[kelvinKeys.length - 1];
            kelvinStops.push(kelvinTable[lastKelvin] + ' 100%');

            document.getElementById('kelvin-slider').style.background =
                'linear-gradient(to right, ' + kelvinStops.join(', ') + ')';

            // Wavelength slider gradient
            var wavelengthStops = [];
            var wavelengthMin = 380;
            var wavelengthMax = 780;
            var wavelengthStep = 10; // Sample every 10nm

            for (var nm = wavelengthMin; nm <= wavelengthMax; nm += wavelengthStep) {
                var color = wavelengthToRGB(nm);
                var percentage = ((nm - wavelengthMin) / (wavelengthMax - wavelengthMin)) * 100;
                wavelengthStops.push(color + ' ' + percentage + '%');
            }

            document.getElementById('wavelength-slider').style.background =
                'linear-gradient(to right, ' + wavelengthStops.join(', ') + ')';

            // Sunset slider gradient
            var sunsetStops = [];
            for (var i = 0; i < sunsetColors.length; i++) {
                var c = sunsetColors[i];
                var hex = '#' + decimalToHex(c.r) + decimalToHex(c.g) + decimalToHex(c.b);
                sunsetStops.push(hex + ' ' + c.pos + '%');
            }

            document.getElementById('sunset-slider').style.background =
                'linear-gradient(to right, ' + sunsetStops.join(', ') + ')';
        }

        // Initialize gradients on page load
        initializeSliderGradients();

        var kelvinSlider = document.getElementById("kelvin-slider");
        kelvinSlider.focus()
        updateKelvinSlider(kelvinSlider.value);
        </script>
    </body>
</html>
